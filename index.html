<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Verificar Dados</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

  <div class="container mt-5">
    <div class="card shadow-sm mx-auto" style="max-width: 500px;">
      <div class="card-body text-center">
        <h2 class="card-title mb-4">Verificação de Dados</h2>
        <input type="text" id="nome" class="form-control mb-3" placeholder="Digite o nome completo" />
        <input type="text" id="cpf" class="form-control mb-3" placeholder="Digite o CPF (com ou sem pontos)" />
        <button class="btn btn-primary w-100" onclick="verificarDados()">Verificar</button>
        <div id="resultado" class="mt-4 fw-bold"></div>
      </div>
    </div>
  </div>

  <script>
    function normalizarCPF(cpf) {
      return cpf.replace(/\D/g, '');
    }

    async function verificarDados() {
      const nome = document.getElementById('nome').value.trim().toLowerCase();
      const cpf = normalizarCPF(document.getElementById('cpf').value);
      const resultado = document.getElementById('resultado');

      if (!nome || !cpf) {
        resultado.textContent = 'Por favor, preencha nome e CPF.';
        resultado.className = 'mt-4 fw-bold text-danger';
        return;
      }

      const sheetId = '1ngw4lhQcnZI_kLxaClGrZ_Ebj5bz1YnMVC3w6sFaKbw';
      const apiKey = 'AIzaSyD3MJgzKLhSZ6gCkXICXlCZqexpkfL2pC4';
      const range = 'Respostas do Formulário 1!B2:I';

      try {
        const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${encodeURIComponent(range)}?key=${apiKey}`;
        const response = await fetch(url);
        const data = await response.json();

        const linhas = data.values || [];
        const linhaEncontrada = linhas.find(celulas =>
          (celulas[0]?.toLowerCase().trim() === nome) &&
          (normalizarCPF(celulas[5] || '') === cpf)
        );

        if (linhaEncontrada) {
          const nomeCompleto = linhaEncontrada[0] || '';
          const cpfFormatado = cpf.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
          const secretaria = linhaEncontrada[7] || 'N/A'; // Coluna H
          const matricula = linhaEncontrada[8] || 'N/A';  // Coluna I

          localStorage.setItem('cartaoDados', JSON.stringify({
            nomeCompleto,
            cpf: cpfFormatado,
            secretaria,
            matricula
          }));
          window.location.href = 'cartao.html';
        } else {
          resultado.textContent = '❌ Dados não encontrados!';
          resultado.className = 'mt-4 fw-bold text-danger';
        }
      } catch (error) {
        console.error('Erro ao acessar a planilha:', error);
        resultado.textContent = 'Erro ao acessar a planilha.';
        resultado.className = 'mt-4 fw-bold text-danger';
      }
    }
  </script>
</body>
</html>
